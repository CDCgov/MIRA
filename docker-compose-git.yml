version: "3.9"
 
x-spyne-git-repo:
  &spyne-git-repo
  https://github.com/CDCgov/spyne.git#prod
 
x-mira-git-repo:
  &mira-git-repo
  https://github.com/CDCgov/MIRA.git#prod
 
x-irma-image:
  &irma-image
  cdcgov/irma:v1.2.0
 
x-dais-image:
  &dais-image
  cdcgov/dais-ribosome:v1.5.4
 
x-spyne-image:
  &spyne-image
  spyne:v2.0.0  
 
x-mira-image:
  &mira-image
  mira:v2.0.0    
 
x-data-volume:
  &data-volume
  type: bind
  source: /path/to/data
  target: /data
 
services:
  spyne:
    container_name: spyne
    image: *spyne-image
    build:
      context: *spyne-git-repo
      dockerfile: Dockerfile
      args:
        irma_image: *irma-image
        dais_image: *dais-image
    restart: always
    networks:
      - backend
    volumes:
      - *data-volume
    command: tail -f /dev/null
 
  mira:
    container_name: mira
    image: *mira-image
    build:
      context: *mira-git-repo
      dockerfile: Dockerfile
      args:
        spyne_image: *spyne-image
    depends_on:
      - spyne    
    restart: always
    networks:
      - frontend
      - backend
    ports:
      - 8020:8050
    volumes:
      - *data-volume
 
networks:
  backend:
    name: backend
  frontend:
    name: frontend