<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • iSpy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="iSpy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iSpy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Dockerization
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/docker.html">Containerizing iSpy with Docker</a>
    </li>
    <li>
      <a href="../articles/docker-compose.html">Running iSpy with Docker-Compose</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    NGS-Training
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/setting-up-containers.html">Setting up Containers</a>
    </li>
    <li>
      <a href="../articles/running-ispy.html">Running Genome Assembly with iSpy</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/FAQs.html">FAQs</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">Change Log</a>
</li>
<li>
  <a href="https://github.com/nbx0/iSpy">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nbx0/iSpy/blob/HEAD/vignettes/running-ispy.Rmd"><code>vignettes/running-ispy.Rmd</code></a></small>
      <div class="hidden name"><code>running-ispy.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="running-ispy">Running iSpy<a class="anchor" aria-label="anchor" href="#running-ispy"></a>
</h2>
<p><img src="images/irma-spy.jpg"></p>
<p><em>This documentation assumes you have the four required Docker
containers (<strong>IRMA</strong>, <strong>DAIS-Ribosome</strong>,
<strong>spyne</strong>, and <strong>iSpy</strong>) already running. If
not, please start with <a href="#setting-up-containers">setting up
containers</a> instructions.</em></p>
</div>
<div class="section level2">
<h2 id="stage-your-demultiplexed-data">Stage your demultiplexed data<a class="anchor" aria-label="anchor" href="#stage-your-demultiplexed-data"></a>
</h2>
<ol style="list-style-type: decimal">
<li>In your “FLU_SC2_SEQUENCING” folder, make a folder for your run. It
is very helpful to name your runs with a consistent naming system, such
as “YEAR-MONTH-DATE-FLOWCELL_ID”, ie. 2022-11-13-ABC1234. <strong><em>DO
NOT PUT SPACES OR SLASHES IN YOU RUN FOLDER NAMES!</em></strong>
</li>
<li>Copy the run’s demultiplexed fastqs into the RUN-FOLDER.
<ol style="list-style-type: decimal">
<li>If this run is from an Oxford Nanopore Technologies’ (ONT)
sequencer, copy the “fastq_pass” directory from the sequencer’s output
into the RUN-FOLDER. On a Mk1C instrument, this is found in
/data/RUN_NAME/EXPERIMENT_NAME/NANOPORE-NAME/fastq_pass where RUN_NAME
and EXPERIMENT_NAME are defined by you in MinKNOW when you set up the
sequencing run on the device and the NANOPORE-NAME is created by the
instrument during the run.</li>
<li>If this run is from an Illumina instrument, create another folder
inside your RUN-FOLDER called “fastqs” and copy the folder containing
demultiplexed fastqs into this newly created fastqs folder so that the
folder structure is
FLU_SC2_SEQUENCING/RUN-FOLDER/fastqs/demultiplexed-fastqs/sample-reads.fastq.
There will be two fastq files per sample.</li>
</ol>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="run-genome-assembly-with-ispy">Run genome assembly with iSpy<a class="anchor" aria-label="anchor" href="#run-genome-assembly-with-ispy"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p>Open Docker Desktop and navigate to the <code>Containers</code>
tab on the left sidebar. Assure that the following containers are
running or run each of them:</p>
<ol style="list-style-type: decimal">
<li>irma-1.0.2p3</li>
<li>dais-ribsome-1.2.1</li>
<li>spyne</li>
<li>iSpy</li>
</ol>
<p><img src="images/dockerdesktop_run_containers.png"></p>
</li>
<li>
<p>Run iSpy by clicking the icon of the box with the arrow pointing
to the top left. This will open iSpy into your defa ult internet
browser.</p>
<p><img src="images/dockerdesktop_launch_irmaspy.png"></p>
</li>
<li>
<p>Click the <code>REFRESH RUN LISTING</code> button and select your
run from the dropdown box.</p>
<p><img src="images/spy-selectRun.png"></p>
</li>
<li>
<p>Now, enter your <code>Barcode numbers</code>. Usually you will be
running a simple range of barcode numbers, such as “1-24”, but to allow
for flexibilty, barcode numbers can be entered in a list combining both
single numbers and number-ranges, such as “1-3,5,9,12-20”. Now enter
your <code>Sample ID</code>s. These can be copy and pasted from a column
in an excel sheet. Sample names should only be numbers, letters, and
underscores (“_“). <strong>Do not use any other characters such as ”-”
or ”/”.</strong> Next, select your <code>Sample Type</code>. Most of
your sample’s are test samples, so each row defaults to
<code>test</code>, but select <code>- control</code> or
<code>+ control</code> for your <strong>negative</strong> and
<strong>positive</strong> controls respectively. Finally, select the
<code>Barcode Expansion Pack</code> you have used during library
preparation. CDC’s laboratory protocol is currently
using”EXP-NBD196”.</p>
<ul>
<li>when running tiny_test_run_flu, enter barcode numbers
<code>27,37,41</code> and make up sample names</li>
<li>when running tiny_test_run_sc2, enter barcode numbers
<code>2,3,5,8,28</code> and make up sample names</li>
</ul>
<p><img src="images/spy-fillSampleSheet.png"></p>
</li>
<li>
<p>Click <code>SAVE SAMPLESHEET</code>. <em>If you need to edit the
number of samples/barcodes in your samplesheet after saving, you must
click</em> <code>RESTART SAMPLESHEET FILLING</code> <em>before editing
it.</em> You will now have to restart filling your samplesheet from the
beginning!</p>
<p><img src="images/spy-saveSamplesheet.png"></p>
</li>
<li>
<p>Now select the correct data type from the drop down box,
<code>What kind of data is this?</code> and click
<code>START GENOME ASSEMBLY</code>. Do not click this button multiple
times. Processing will take quite a long time depending on your
computers specificatoins and the number of samples you are processing.
Now is a good time to go have a coffee. :coffee:</p>
<p><img src="images/spy-selectDataType.png"></p>
<p>Click on the toggle button <code>Watch IRMA Progress</code>. Assembly
will take some time, how long exactly is dependent on your sample
number, the number of raw sequencing reads, and the power of your
computer. <img src="images/spy-IRMAprogess.png"></p>
</li>
<li>
<p>When IRMA has finished, “Updating” will no longer be displayed on
iSpy’s brower tab. Click on <code>DISPLAY IRMA RESULTS</code>. You may
need to <em>refresh</em> the webpage.</p>
<p><img src="images/spy-displayResults.png"></p>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="review-irma-results">Review IRMA results<a class="anchor" aria-label="anchor" href="#review-irma-results"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p>Review the distribution of reads assigned to each barcode. The
ideal result would be a similar number of reads assigned to each test
and positive control. However, it is ok not have similar read numbers
per sample. Samples with a low proportion of reads may indicate higher
Ct of starting material or less performant PCR during library
preparation. What is most important for sequencing assembly is raw count
of reads and their quality.</p>
<p><img src="images/spy-barcodeDistribution.png"></p>
</li>
<li>
<p>Review the “Automatic Quality Control Decisions” heatmap. In
addition to IRMA’s built in quality control, iSpy requires a minimum
mean coverage of 50x, a minimum coverage of reference of 90%, and a
maximum number of minor variants &gt;=5% of 10. These are marked in
yellow to orange according to the number of these failure types. Samples
that failed to generate any assembly are marked in red. In addition,
premature stop codons are flagged in yellow. CDC does not submit
sequences with premature stop codons, particularly in HA, NA or
SARS-CoV-2 Spike. Outside of those genes, premature stop codons near the
end of the gene may be ok for submission.</p>
<p><img src="images/spy-qc_heatmap.png"></p>
</li>
<li>
<p>Review <code>Irma Summary</code>. This summarizes the above
information, as well as detailed read assignment to specific referencs,
in a table. Click <code>Export</code> to save this as an Excel file.</p>
<p><img src="images/spy-IRMAsummary.png"></p>
</li>
<li>
<p>Review genome coverage depth. The heatmap summarizes the mean
coverage per sample per gene. All the images in iSpy can be interacted
with. Play with the gray buttons on the top right of the images. The
camera icon will save the image. Clicking on a sample in the heatmap, or
selecting one in the drop down menu will display two plots. On the left
is a “sankey plot” that shows the number of reads assigned to the
barcode, how many of those passed IRMA’s QC, and how many are assigned
to each gene reference. The plot on the right shows the sample’s
complete coverage per gene. Try toggling the
<code>log y --- ilnear y</code> button. In log space, you likely need to
reset the view by clicking the gray button in the top right that looks
like an X inside of a box. You can also try panning and zooming the
plot.</p>
<p><img src="images/spy-coverage1.png"><img src="images/spy-coverage2.png"></p>
</li>
<li>
<p>Inspect amino acid variants against popular reference
sequences.</p>
<p><img src="images/spy-AAvariants.png"></p>
</li>
<li>
<p>Inspect minor variation at single nucleotides, insertions and
deletions <em>relative to the sample’s generated consensus
sequence.</em> These tablee are for your own usage and not necessary to
review in detail. They can be sorted and filtered and exported to excel
sheets for further analyses.</p>
<p><img src="images/spy-minorAlleles.png"></p>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="save-your-sequence-fasta">Save your sequence fasta<a class="anchor" aria-label="anchor" href="#save-your-sequence-fasta"></a>
</h2>
<ul>
<li>
<p>Export IRMA’s <em>amended consensus</em> nucleotide sequences and
amino acid fasta files. This includes only those passing iSpy’s QC
criteria and are ready for submission to public databases!</p>
<p><img src="images/spy-saveFasta.png"></p>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="gisaid-httpsgisaid-org">GISAID: <a href="https://gisaid.org/" class="external-link">https://gisaid.org/</a><a class="anchor" aria-label="anchor" href="#gisaid-httpsgisaid-org"></a>
</h2>
</div>
<div class="section level2">
<h2 id="ncbi-genbank-httpswww-ncbi-nlm-nih-govgenbank">NCBI-Genbank: <a href="https://www.ncbi.nlm.nih.gov/genbank/" class="external-link">https://www.ncbi.nlm.nih.gov/genbank/</a><a class="anchor" aria-label="anchor" href="#ncbi-genbank-httpswww-ncbi-nlm-nih-govgenbank"></a>
</h2>
</div>
<div class="section level2">
<h2 id="ncbi-blast-httpsblast-ncbi-nlm-nih-govblast-cgi">NCBI-BLAST: <a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi" class="external-link">https://blast.ncbi.nlm.nih.gov/Blast.cgi</a><a class="anchor" aria-label="anchor" href="#ncbi-blast-httpsblast-ncbi-nlm-nih-govblast-cgi"></a>
</h2>
</div>
<div class="section level2">
<h2 id="nextclade-httpsclades-nextstrain-org">Nextclade: <a href="https://clades.nextstrain.org/" class="external-link">https://clades.nextstrain.org/</a><a class="anchor" aria-label="anchor" href="#nextclade-httpsclades-nextstrain-org"></a>
</h2>
</div>
<div class="section level2">
<h2 id="getting-help">Getting help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>See <a href="FAQs.html#how-to-upgrate-or-remove-older-versions-of-ispy-or-other-containers">FAQs
Guide on how to upgrade and remove older versions of iSpy</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/nbx0" class="external-link">Ben Rambo-Martin</a>, <a href="https://github.com/kristinelacek" class="external-link">Kristine Lacek</a>, <a href="https://github.com/rchau88" class="external-link">Reina Chau</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
